# DBshop日记3

于2023-10-11日记录

以上为目前工具的使用，简单的概括：**功能以完成，剩下的就交给时间。**

并且对比功能，数据库之间对比这一实际的投入到了我平时和同事的开发使用中，效果比预想中的要好的多。

在没有复杂情况中，比如复合主键、在未找到转换规则定义中的特殊字段、非常用索引...，已经可以做到稍作检查就可以直接使用自动生成出来的Sql。

`有成果的收获更令人美味`

## 开发小结

在[日记2](https://leyunone.com/development-diary/dbshop/dbshop-2.html)的记录中，有提到Sql语句的自动解析，这方面也是到目前为止最费力的环节。

首先Sql语句总类很多，

- 新增字段
- 修改字段
- 创建表
- 删除表主键
- 删除自增
- 新增自增
- ....

在最开始的设计中，解析流程大致如下：

1. 两表对比，发现有差异，根据类型、名字等因素定位到具体表的具体字段
2. 根据主从表设置，决定该字段需要生成 新增\修改\删除 类型SQL
3. 调用工具，通过Sql模板的设置生成对应类型的字符串
4. 执行字段类型转换策略

在早期设置sql类型少的时候，只需要添加工具中对于各类型SQL的生成方式的逻辑就好。

但是当遇到创建表，表中设置自增、主键、索引...这种组合型的复合类型，随着类型增多，愈加难以维护。

最终 流程3，调用工具，采取了设计模式中策略模式的设计。

将各个类型的SQL对应到具体策略中，复合型SQL则只需要建立起策略执行链路。

