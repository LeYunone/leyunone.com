# 主从数据库延时同步问题

## 背景

在一些大数据业务，比如实时股票、实时日志、实时...等，需要大数据支撑的同时也需要数据的时效性。

当数据量愈来愈大，且请求、业务等体量的增大，在分配主从数据库读写问题上，很容易出现数据的延时复制的问题。

为此，针对如何主从复制的延时问题的方案策对上，有很多很多有意思或深奥的策略；

以下 针对 `主从数据库复制延时` 进行讨论

## 问题

主从数据库有延时，说到延时很容易想到造成他的几种原因：

- 网络延时
- 主数据库服务器卡顿
- 从数据库服务器卡顿
- 服务器故障问题
- 文件解析问题：包括但不限于，主从时间不同步、文件编码、传输丢失等等
- ......

可以发现，除去比较客观的因素，最能影响到主从数据库复制的因素主要是两点：

1. CPU、IO性能的最低保证
2. 针对binlog传输、解析、存储技术的优化

而对于网络延时这一主体问题，最常用的是考虑下面几步走：

1. 机器不好，加钱加带宽
2. 没钱，减少两者服务器中的宽带占用
3. 没有空余空间保留，那么就只能尽可能的将两这服务器部署在同一中心、宽带近点上
4. 这也不行，那就等~~有钱吧~~

另外，以上问题多针对服务器性能，另一类则是来自开发者或维护人员即：**长且大事务的提交**、**数据库配置**、**缓存技术**...

## 主从设计

![](https://leyunone-img.oss-cn-hangzhou.aliyuncs.com/image/2024-01-11/2359c69f-d0f0-40c4-8a30-b8c72a4b1409.png)

以上为一个简单的主从数据库写入、读取、使用的架构图，大多主从设计上八九不离十是：一主x从、多主x从，主主互从。

而延时问题一般在这几个分支上：

1. 主传输binlog速度慢
2. 从接收binlog速度慢
3. 并发时，IO过载，解析和传输都慢
4. 写数据库时，执行了大事务





