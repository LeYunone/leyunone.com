# 系统保护性设计

在我们的项目上线之后，总会出现各种各样的意外，比方说代码版本，锁并发，占用长连接等等导致Pn级的事故出现；

即使对服务器，系统，应用保护的再好也会因为一些纰漏造成水滴石穿的效果，不过俗话说的好：

**吃一堑长一智** 

在各方应对各种杂疑难症后，脑中也浮现了一些对于可能会出现的事故，提前需要做出的保护性设计；这可能是在代码层面，系统层面，监控层面...

## 限流与过滤

限流=过滤吗？

不完全等于，在应对层面过滤希望的是减少带宽消耗；限流则是针对某个接口的某个功能在特定时间下的稳定性；

### 过滤

在项目中有接入大数据量的消费需求时，需要考虑到如何在大数据量同时或者源源不断过来时，我们的系统在接入层的保护性设计；

一般除了保证接入方的集群，高可用外，对数据进行非有效数据的过滤是一定要思考到的；

这里按照我的经验过滤层的设计上有两方面：

1. 消息生产者/消息中间件的过滤脚本设计
2. 消息先通过“过滤应用”再转发到我方应用

前者好商量，是从源头上使用各个中间件的脚本处理插件或者生产者自行判断不无脑发送消息；

后者则是通过一个子服务为主服务流量分流；

所以前者不提，后者我提出一个很新颖的骚操作；

一般来说，过滤服务往往是由以下结构组成

![](https://leyunone-img.oss-cn-hangzhou.aliyuncs.com/image/2024-07-24/2.png)

需要接入redis或者db判断这条数据是否有效需被过滤；

虽然redis性能很足，但是在小应用中，指3000dps下的应用中；

我们是可以直接采用纯内存的判断，使用JVM的常量+IO读文件+内存对象进行判断的；

相当于手写一个缓存存储的过滤应用，不走任何中间件；是否可行，这里推荐大伙自行小小的写一个demo去判断这种纯内存的应用性能，这里提一个关键字：由于是纯内存，依靠JVM的性能，那么就等同于服务器CPU越好性能就可以越高；

### 限流



## 监控与扩容

